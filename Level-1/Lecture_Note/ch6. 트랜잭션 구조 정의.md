# 6강. 트랜잭션 구조 정의: “서명된 의사결정”이 실행되어 상태를 바꾸는 과정

## 0) 이 강의의 한 문장
**트랜잭션은 ‘기록’이 아니라, 키로 서명된 ‘의사결정(명령)’이다.**  
네트워크는 그 의사결정이 규칙을 만족하는지 검증하고, 실행하여 상태(State)를 바꾼 뒤 그 결과를 기록한다.

---

## 1) 강의 목표 (수강생이 끝나고 할 수 있어야 하는 것)
이 강의를 마치면 수강생은:

1. 트랜잭션을 “송금 기록”이 아니라 **서명된 명령(Instruction)** 으로 정의할 수 있다.  
2. 트랜잭션의 핵심 구성요소(From/To/Value/Data/Nonce/Gas/Signature/ChainId)를 역할별로 설명할 수 있다.  
3. “트랜잭션 → 실행 → 상태 변화 → 영수증/로그” 흐름을 단계별로 말할 수 있다.  
4. 전송형 트랜잭션(EOA→EOA)과 컨트랙트 호출(EOA→Contract)의 구조적 차이를 구분할 수 있다.  
5. 다음 강의(지갑/주소/결과 구분)로 연결: “실패도 결과로 기록된다”와 “가스는 실행 조건”을 자연스럽게 이해한다.

---

## 2) 도입 멘트 (강의 시작 2~3분 대본)
> 많은 분들이 트랜잭션을 “누가 누구에게 얼마 보냈다” 정도로 생각합니다.  
> 그런데 구조 설계자 관점에서는 이렇게 봐야 해요.  
>  
> **트랜잭션은 ‘기록’이 아니라 ‘명령’** 입니다.  
> “이 행동을 하겠다”는 의사결정을 키로 서명해서 네트워크에 제출하는 거죠.  
>  
> 오늘은 트랜잭션을 ‘기록’이 아니라 ‘행동’으로 다시 정의하고,  
> 그 행동이 실행되어 상태를 바꾸는 전체 구조를 잡아보겠습니다.

---

## 3) 핵심 정의: 트랜잭션 = 서명된 의사결정(Instruction)
트랜잭션을 구조적으로 정의하면:

- **누가(From)**  
- **무엇을/어디에(To)**  
- **어떤 조건으로(Gas/Nonce/ChainId 등)**  
- **어떤 내용을(Data)**  
- **승인한다(Signature)**

즉, 트랜잭션은 “나는 이 행동을 하겠다”는 **명령 패킷**이다.

**암기 문장**
- 트랜잭션은 “나의 의사(명령)”  
- 실행은 “명령을 수행”  
- 상태 변화는 “세계가 바뀐 결과”  
- 영수증/로그는 “증거/흔적”

---

## 4) 트랜잭션의 구성요소(역할로 이해하기)
(체인/표준마다 표현은 다르지만, 초급에서 구조 이해는 아래로 충분)

### A. From(발신자)
- 트랜잭션을 “서명한 키”가 통제하는 주소
- 누가 이 행동을 승인했는지의 기준점

### B. To(수신자/대상)
- 단순 송금이면: 상대 주소(EOA)  
- 호출이면: 컨트랙트 주소(Contract)

### C. Value(전송값)
- 네이티브 자산(예: ETH)을 직접 보내는 값
- 컨트랙트 호출에서도 value를 함께 보낼 수 있다(예: payable)

### D. Data(입력 데이터)
- 이게 ‘WEB3 행동’의 핵심이다.
- 컨트랙트 호출에서는 함수 선택자 + 인자들이 data로 들어간다.
- 송금 트랜잭션은 data가 비어있거나 간단할 수 있다.

**설계자 포인트**
- “value”는 자산 이동,  
- “data”는 행동(로직 실행)을 의미한다.

### E. Nonce(재사용 방지 / 순서)
- 같은 주소에서 나온 트랜잭션의 순서를 보장하고 재전송을 막는다.
- nonce가 꼬이면 “내가 한 행동”의 순서가 꼬인다.

### F. Gas 관련(가스 한도/가격)
- 가스는 비용이기도 하지만, 구조적으로는 **실행 조건(Execution Constraint)** 이다.
- “이 명령을 실행하는 데 사용할 연료/자원을 여기까지 허용하겠다”라는 제한 장치

### G. ChainId(체인 식별)
- 같은 서명이라도 다른 체인에서 재사용되는 것을 막는 안전장치(리플레이 방지 개념)
- “어느 세계에서 이 의사를 제출했는지”를 고정한다.

### H. Signature(서명)
- “이 트랜잭션은 From 주소의 키가 승인했다”는 증거
- 서명이 없으면 명령은 무효가 된다.

---

## 5) 트랜잭션의 유형: 송금 vs 호출(초급에서 반드시 구분)
### 5.1 송금(EOA → EOA)
- 목적: 자산(value) 이동
- data: 보통 비어있음
- 결과: 잔액 감소/증가 같은 단순 상태 변화가 중심

### 5.2 컨트랙트 호출(EOA → Contract)
- 목적: “코드 실행”을 통한 상태 변화
- data: 함수 호출 정보가 핵심
- 결과: 상태(storage) 변경, 이벤트 로그, 내부 전송, 토큰 이동 등 복합

**암기 문장**
- 송금은 “돈 이동”  
- 호출은 “규칙(코드) 실행”

---

## 6) 트랜잭션 라이프사이클: “명령이 세계를 바꾸는” 9단계
(4강의 8단계와 겹치지만, 이번 강의에서는 “트랜잭션 내부 관점”으로 더 촘촘히)

1) 사용자가 의사결정: 무엇을 할지 결정(To/Value/Data)  
2) 트랜잭션 생성: nonce/gas/chainId 포함  
3) 서명(Sign): 개인키로 승인  
4) 전파(Broadcast): 네트워크로 제출  
5) 기본 검증(Validation): 형식/서명/nonce/잔액/가스 조건 확인  
6) 후보 묶음(대기열/블록 후보): 누가 어떤 트랜잭션을 담을지 선택(합의 영향)  
7) 실행(Execution): EVM/실행 엔진에서 코드/상태 전이 수행  
8) 결과 생성: 상태 변화 + 영수증(receipt) + 로그(logs)  
9) 채택/확정(Consensus): 블록에 포함되어 공식 기록이 되고, 시간이 지나 확정성이 커짐

---

## 7) 트랜잭션의 결과물 3종: 상태(State) / 영수증(Receipt) / 로그(Logs)
초급이 가장 많이 놓치는 포인트는 “트랜잭션 결과가 1개가 아니라는 것”.

### A. 상태(State)
- 진짜 현실: 잔액, nonce, 컨트랙트 저장소, 토큰 소유 등
- 사용자가 결국 얻고 싶은 결과는 상태 변화다.

### B. 영수증(Receipt)
- 실행 결과 요약: 성공/실패 여부, 가스 사용량, 로그 위치 등
- “이 트랜잭션이 실행되었다”는 증명에 가깝다.

### C. 로그(Logs / Events)
- 컨트랙트가 “외부에 남기는 흔적”
- 인덱싱/분석/대시보드의 핵심 재료(온체인 분석은 여기서 시작하는 경우가 많음)
- 단, 로그는 상태가 아니라 “기록용 이벤트”에 가깝다(중요한 구분)

**설계자 관점 한 문장**
- 상태는 “진짜”, 로그는 “설명”, 영수증은 “증명”이다.

---

## 8) 트랜잭션을 ‘행동 기록’으로 읽는 법(구조 설계자 스킬)
트랜잭션을 볼 때 아래 질문을 습관화하면 “구조 읽기”가 된다.

1) 주체(Subject): From은 누구인가? 이 키의 통제권은 어디에 있나?  
2) 대상(Object): To는 EOA인가 Contract인가?  
3) 행동(Action): data가 무엇을 호출하는가? value는 동반되는가?  
4) 조건(Constraints): nonce/gas 조건은 무엇을 의미하나?  
5) 결과(Result): 상태 변화는 무엇이고, 로그는 무엇을 말하나?

---

## 9) 미니 케이스(강의 중 10~15분)
### 케이스 1: “토큰을 보냈는데 상대가 못 받았다”
가능한 구조적 원인:
- 실제로는 토큰 전송이 아니라 컨트랙트 호출이었고, revert가 났다(실행 실패)
- 승인(approve) 없이 transferFrom 구조를 호출했다(행동 설계 이해 부족)
- 체인/네트워크를 잘못 선택했다(chainId/네트워크 실수)
- 수수료(가스) 부족으로 실행이 중단되었다(실행 조건 실패)

핵심:
- “보냈다/못 받았다”가 아니라  
  “어떤 행동이 실행됐고, 어떤 상태 변화가 있었나”로 재해석한다.

### 케이스 2: “트랜잭션이 계속 pending이다”
가능한 구조적 원인:
- nonce 충돌/이전 트랜잭션이 막혀 있다
- 가스 조건(우선순위)이 낮아 합의 단계에서 선택되지 않는다
- 네트워크 혼잡

---

## 10) 미니 실습(20분) — 익스플로러로 트랜잭션을 ‘행동’으로 해독하기
### 실습 주제: 트랜잭션 1개를 골라 5요소로 해석하기
아래 항목을 채워서 “행동 해석 카드”를 만든다.

- Subject(주체): From = ?  
- Object(대상): To = EOA/Contract?  
- Action(행동): value/data는 무엇을 의미? (가능하면 함수명/메서드)  
- Constraints(조건): nonce/gas는 어떤 상황을 말하나?  
- Result(결과): 성공/실패, 상태 변화 요약, 로그 1개 해석

**출력(산출물)**: “트랜잭션 행동 해석 카드 1장”

---

## 11) 과제
### 과제 1: 트랜잭션 3종 분석 리포트(각 0.5페이지, 총 1.5페이지)
아래 3개를 각각 5요소(주체/대상/행동/조건/결과)로 해석한다.

1) EOA→EOA 송금 1건  
2) 컨트랙트 호출 1건(DEX 스왑/토큰 전송 등 아무거나)  
3) 실패(revert) 트랜잭션 1건

### 과제 2(선택): “기록” 관점 문장 고치기
아래 문장을 “행동/구조” 관점으로 바꿔쓰기
- “트랜잭션은 송금 기록이다.”  
- “가스는 수수료다.”  
- “실패한 트랜잭션은 아무 의미가 없다.”

---

## 12) 강의 마무리 30초 대본
> 오늘 우리는 트랜잭션을 ‘기록’이 아니라 ‘명령’으로 다시 정의했습니다.  
> 키로 서명된 의사가 네트워크 규칙을 통과하면 실행되고,  
> 실행 결과로 상태가 바뀌며, 영수증과 로그가 남습니다.  
>  
> 다음 강의에서는 이 결과를 더 명확히 구분하는 방법—  
> 성공/실패, 그리고 가스가 왜 ‘비용’이 아니라 ‘실행 조건’인지 들어가겠습니다.

---

## 13) 퀴즈(12문항, 복습용)
1) 트랜잭션을 한 문장으로 정의하라(“서명된 의사결정”).  
2) From/To/Value/Data는 각각 무엇을 의미하는가?  
3) nonce의 역할은 무엇인가?  
4) gas를 “실행 조건”이라고 부르는 이유는 무엇인가?  
5) chainId가 중요한 이유는 무엇인가?  
6) 서명이 증명하는 것은 무엇인가?  
7) EOA→EOA 송금과 EOA→Contract 호출의 핵심 차이는?  
8) 트랜잭션 라이프사이클 9단계를 순서대로 말하라.  
9) 상태(State)와 로그(Logs)의 차이는 무엇인가?  
10) 영수증(Receipt)은 무엇을 담는가?  
11) pending의 구조적 원인 2가지를 말하라.  
12) 실패 트랜잭션이 의미 있는 이유 1가지를 말하라.

---

## 14) (집필 확장용) 이 강의를 책으로 옮기면 이렇게 된다
- 1. 트랜잭션은 기록이 아니라 명령이다  
- 2. 트랜잭션 구성요소를 역할로 이해하기  
- 3. 송금 vs 호출: 행동의 차이  
- 4. 트랜잭션 라이프사이클(서명→검증→실행→채택)  
- 5. 결과물 3종: 상태/영수증/로그  
- 6. 트랜잭션을 행동으로 읽는 5요소 프레임  
- 7. 실습: 익스플로러로 행동 해석 카드 만들기  
- 8. 다음 장 예고: 성공·실패, 가스 조건의 구조적 의미
