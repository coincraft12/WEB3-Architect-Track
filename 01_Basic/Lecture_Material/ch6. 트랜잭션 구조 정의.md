# 6강. 트랜잭션 구조 정의: “서명된 의사결정”이 실행되어 상태를 바꾸는 과정

## 1) 이 강의의 한 문장
**트랜잭션은 ‘기록’이 아니라, 키로 서명된 ‘의사결정(명령)’이다.**  
네트워크는 그 의사결정이 규칙을 만족하는지 검증하고, 실행하여 상태(State)를 바꾼 뒤 그 결과를 기록한다.

---

## 2) 강의 목표 (수강생이 끝나고 할 수 있어야 하는 것)
이 강의를 마치면 수강생은:

1. 트랜잭션을 “송금 기록”이 아니라 **서명된 명령(Instruction)** 으로 정의할 수 있다.  
2. 트랜잭션의 핵심 구성요소(From/To/Value/Data/Nonce/Gas/Signature/ChainId)를 역할별로 설명할 수 있다.  
3. “트랜잭션 → 실행 → 상태 변화 → 영수증/로그” 흐름을 단계별로 말할 수 있다.  
4. 전송형 트랜잭션(EOA→EOA)과 컨트랙트 호출(EOA→Contract)의 구조적 차이를 구분할 수 있다.  
5. 다음 강의(지갑/주소/결과 구분)로 연결: “실패도 결과로 기록된다”와 “가스는 실행 조건”을 자연스럽게 이해한다.

---

## 3) 핵심 정의: 트랜잭션 = 서명된 의사결정(Instruction)
트랜잭션을 구조적으로 정의하면:

- **누가(From)**  
- **무엇을/어디에(To)**  
- **어떤 조건으로(Gas/Nonce/ChainId 등)**  
- **어떤 내용을(Data)**  
- **승인한다(Signature)**

즉, 트랜잭션은 “나는 이 행동을 하겠다”는 **명령 패킷**이다.

**암기 문장**
- 트랜잭션은 “나의 의사(명령)”  
- 실행은 “명령을 수행”  
- 상태 변화는 “세계가 바뀐 결과”  
- 영수증/로그는 “증거/흔적”

---

## 4) 트랜잭션의 구성요소(역할로 이해하기)
(체인/표준마다 표현은 다르지만, 초급에서 구조 이해는 아래로 충분)

### A. From(발신자)
- 트랜잭션을 “서명한 키”가 통제하는 주소
- 누가 이 행동을 승인했는지의 기준점

### B. To(수신자/대상)
- 단순 송금이면: 상대 주소(EOA)  
- 호출이면: 컨트랙트 주소(Contract)

### C. Value(전송값)
- 네이티브 자산(예: ETH)을 직접 보내는 값
- 컨트랙트 호출에서도 value를 함께 보낼 수 있다(예: payable)

### D. Data(입력 데이터)
- 이게 ‘WEB3 행동’의 핵심이다.
- 컨트랙트 호출에서는 함수 선택자 + 인자들이 data로 들어간다.
- 송금 트랜잭션은 data가 비어있거나 간단할 수 있다.

**설계자 포인트**
- “value”는 자산 이동,  
- “data”는 행동(로직 실행)을 의미한다.

### E. Nonce(재사용 방지 / 순서)
- 같은 주소에서 나온 트랜잭션의 순서를 보장하고 재전송을 막는다.
- nonce가 꼬이면 “내가 한 행동”의 순서가 꼬인다.

### F. Gas 관련(가스 한도/가격)
- 가스는 비용이기도 하지만, 구조적으로는 **실행 조건(Execution Constraint)** 이다.
- “이 명령을 실행하는 데 사용할 연료/자원을 여기까지 허용하겠다”라는 제한 장치

### G. ChainId(체인 식별)
- 같은 서명이라도 다른 체인에서 재사용되는 것을 막는 안전장치(리플레이 방지 개념)
- “어느 세계에서 이 의사를 제출했는지”를 고정한다.

### H. Signature(서명)
- “이 트랜잭션은 From 주소의 키가 승인했다”는 증거
- 서명이 없으면 명령은 무효가 된다.

---

## 5) 트랜잭션의 유형: 송금 vs 호출(초급에서 반드시 구분)
### 송금(EOA → EOA)
- 목적: 자산(value) 이동
- data: 보통 비어있음
- 결과: 잔액 감소/증가 같은 단순 상태 변화가 중심

### 컨트랙트 호출(EOA → Contract)
- 목적: “코드 실행”을 통한 상태 변화
- data: 함수 호출 정보가 핵심
- 결과: 상태(storage) 변경, 이벤트 로그, 내부 전송, 토큰 이동 등 복합

**암기 문장**
- 송금은 “돈 이동”  
- 호출은 “규칙(코드) 실행”

---

## 6) 트랜잭션 라이프사이클: “명령이 세계를 바꾸는” 9단계
(4강의 8단계와 겹치지만, 이번 강의에서는 “트랜잭션 내부 관점”으로 더 촘촘히)

1) 사용자가 의사결정: 무엇을 할지 결정(To/Value/Data)  
2) 트랜잭션 생성: nonce/gas/chainId 포함  
3) 서명(Sign): 개인키로 승인  
4) 전파(Broadcast): 네트워크로 제출  
5) 기본 검증(Validation): 형식/서명/nonce/잔액/가스 조건 확인  
6) 후보 묶음(대기열/블록 후보): 누가 어떤 트랜잭션을 담을지 선택(합의 영향)  
7) 실행(Execution): EVM/실행 엔진에서 코드/상태 전이 수행  
8) 결과 생성: 상태 변화 + 영수증(receipt) + 로그(logs)  
9) 채택/확정(Consensus): 블록에 포함되어 공식 기록이 되고, 시간이 지나 확정성이 커짐

---

## 7) 트랜잭션의 결과물 3종: 상태(State) / 영수증(Receipt) / 로그(Logs)
초급이 가장 많이 놓치는 포인트는 “트랜잭션 결과가 1개가 아니라는 것”.

### A. 상태(State)
- 진짜 현실: 잔액, nonce, 컨트랙트 저장소, 토큰 소유 등
- 사용자가 결국 얻고 싶은 결과는 상태 변화다.

### B. 영수증(Receipt)
- 실행 결과 요약: 성공/실패 여부, 가스 사용량, 로그 위치 등
- “이 트랜잭션이 실행되었다”는 증명에 가깝다.

### C. 로그(Logs / Events)
- 컨트랙트가 “외부에 남기는 흔적”
- 인덱싱/분석/대시보드의 핵심 재료(온체인 분석은 여기서 시작하는 경우가 많음)
- 단, 로그는 상태가 아니라 “기록용 이벤트”에 가깝다(중요한 구분)

**설계자 관점 한 문장**
- 상태는 “진짜”, 로그는 “설명”, 영수증은 “증명”이다.

---

## 8) 트랜잭션을 ‘행동 기록’으로 읽는 법(구조 설계자 스킬)
트랜잭션을 볼 때 아래 질문을 습관화하면 “구조 읽기”가 된다.

1) 주체(Subject): From은 누구인가? 이 키의 통제권은 어디에 있나?  
2) 대상(Object): To는 EOA인가 Contract인가?  
3) 행동(Action): data가 무엇을 호출하는가? value는 동반되는가?  
4) 조건(Constraints): nonce/gas 조건은 무엇을 의미하나?  
5) 결과(Result): 상태 변화는 무엇이고, 로그는 무엇을 말하나?

---

