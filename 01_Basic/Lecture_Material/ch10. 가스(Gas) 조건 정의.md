# 10강. 가스(Gas) 조건 정의: “수수료”가 아니라 실행 조건(Execution Constraint) 모델

## 1) 이 강의의 한 문장
**가스는 단순한 수수료가 아니라, 블록체인이 ‘실행 자원’을 안전하게 배분하기 위해 만든 실행 조건 모델이다.**  
즉, 가스는 “돈”이 아니라 “실행 가능성”과 “자원 상한”을 설계하는 장치다.

## 2) 강의 목표 (수강생이 끝나고 할 수 있어야 하는 것)
이 강의를 마치면 수강생은:

1. 가스를 “비용”이 아니라 **실행 조건/자원 한도/우선순위**로 정의할 수 있다.  
2. gas limit / gas used / gas price(또는 fee 구성)를 구분하고 역할을 말할 수 있다.  
3. 트랜잭션이 실패(pending/revert)하는 주요 원인 중 가스 관련 원인을 구조적으로 분류할 수 있다.  
4. 사용자 관점에서 “왜 가스를 조절해야 하는지”, 서비스/프로토콜 관점에서 “왜 가스가 보안장치인지” 설명할 수 있다.  
5. 다음 강의(스마트컨트랙트 계정)로 연결: “코드 실행은 자원을 먹고, 그 자원을 가스로 계량한다”를 이해한다.

## 3) 핵심 정의: 가스의 3가지 역할
### 자원 계량(Resource Metering)
- 컨트랙트 실행은 CPU/메모리/스토리지처럼 “자원”을 소비한다.
- 가스는 이 자원 소비를 **정량화**한다.

### 실행 상한(Execution Cap)
- 트랜잭션에 “이 정도까지만 실행을 허용한다”는 상한을 건다.
- 무한 루프/과도한 연산을 막는 안전장치다.

### 우선순위/시장 메커니즘(Priority)
- 블록 공간은 제한되어 있다.
- 가스 조건은 “어떤 트랜잭션을 먼저 포함할지”에 영향을 준다(합의 단계와 연결).

**암기 문장**
- 가스는 “실행을 돈으로 바꾸는 게 아니라, 실행을 ‘제약’으로 바꾸는 장치”다.

## 4) 초급 필수 용어 5개(역할 중심)
### A. Gas Limit (가스 한도)
- 내가 이 트랜잭션에 허용하는 최대 실행량
- **실행 상한** 역할

### B. Gas Used (가스 사용량)
- 실제로 실행이 소비한 가스
- 결과(영수증)에 남는다

### C. Gas Price / Fee (가격 요소)
- “가스 1단위당 얼마를 지불할지”의 조건
- 네트워크 혼잡에서 포함 우선순위에 큰 영향

### D. Base Fee / Priority Fee (개념 이해용)
- (개념적으로) 기본 수요에 따라 필요한 최소 비용 vs 우선 처리 유도 인센티브
- 초급에서는 “두 층의 가격이 있을 수 있다” 정도만 잡고 넘어가도 충분

### E. Block Gas Limit / Block Capacity (블록 수용량)
- 한 블록에 담을 수 있는 총 실행량의 상한
- 가스 시장이 생기는 구조적 이유

## 5) 가스가 없으면 어떤 일이 벌어지는가? (존재 이유를 직관으로)
가스가 없으면:

1) **무한 실행 공격**이 가능해진다  
- 악의적 컨트랙트가 무한 루프/과도한 연산으로 네트워크를 마비

2) **자원 소비를 누가 부담할지**가 불명확해진다  
- 공짜 실행이면 스팸이 폭발한다

3) **블록 공간 경쟁을 해결할 방법**이 없다  
- 제한된 처리량에서 “어느 요청을 먼저 처리할지”가 난제

따라서 가스는:
- 보안(DoS 방어)
- 안정성(자원 상한)
- 경제성(우선순위/시장)
을 동시에 해결하는 장치다.

## 6) 가스 관점에서 보는 “트랜잭션 상태” 4종(사용자 체감과 연결)
가스를 이해하면 pending/실패가 깔끔해진다.

1) **미포함(pending)**  
- 가스 가격 조건이 낮거나 네트워크가 혼잡해서 “선택”되지 않음  
- (합의/시장 요인)

2) **포함 + 성공(success)**  
- 실행이 한도 내에서 완료  
- 상태 변화 반영

3) **포함 + 실패(revert)**  
- 실행이 시도되었고 가스 일부/전부가 소모될 수 있음  
- 조건 불충족/권한 부족/로직 문제 등(실행 실패)

4) **포함 + 가스 부족(out of gas) 성격의 실패**  
- 실행이 끝나기 전에 가스 한도가 바닥나 중단  
- “돈이 부족해서”가 아니라 “실행 자원 상한이 너무 낮아서”인 경우가 많다

**핵심**
- pending은 “가격/우선순위”  
- revert/out-of-gas는 “실행 조건/한도”와 깊게 연결된다

## 7) “가스는 비용”이라는 오해를 깨는 3가지 질문
### 질문 1) 왜 가스 한도를 사용자가 정하게 할까?
- 사용자가 “이 행동에 어디까지 자원을 허용할지”를 결정하게 함으로써
- 네트워크가 무제한 실행을 강제당하지 않도록 한다.

### 질문 2) 왜 가스 가격이 변할까?
- 블록 수용량이 제한된 상황에서 수요가 변하기 때문
- 구조적으로 “시장”이 된다

### 질문 3) 왜 실패해도 가스가 나갈까?
- 실행을 ‘시도’했기 때문에 자원이 소비됨
- 실패를 공짜로 만들면 스팸/공격이 쉬워진다

## 8) 구조 설계자 관점: 가스는 UX/보안의 핵심 경계
### 사용자 UX 문제
- “가스 너무 비싸서 못 하겠다”
- “설정 잘못해서 계속 pending이다”
- “가스 한도 낮게 잡아서 out-of-gas로 실패했다”

→ 지갑/서비스는 가스를 “가격”이 아니라 “성공 확률”로 안내해야 한다.

### 프로토콜/서비스 보안 문제
- 가스 비용이 낮아지면 스팸/봇이 늘 수 있다
- 어떤 함수는 가스가 과하게 들게 설계되어 DoS 벡터가 될 수 있다
- 스토리지 쓰기/루프/배열 처리 같은 패턴은 가스 리스크가 크다

**핵심 문장**
- 가스는 개발자에게는 “자원 설계”, 사용자에게는 “행동 가능성”이다.

## 용어 보충(Quick Reference)
- Gas Limit: 해당 트랜잭션에 허용한 최대 연산량.
- Gas Used: 실제 실행에 소비된 가스 양.
- Base Fee: 블록 혼잡도에 따라 프로토콜이 정하는 기본 수수료 단가.
- Priority Fee: 채굴/검증자 우선 포함 유인을 위한 추가 수수료.
- Fee Market: 블록 공간 우선순위를 가격으로 배분하는 메커니즘.

## 헷갈리는 개념 보충
- 가스는 단순 수수료가 아니라 실행 자원 한도와 우선순위 모델이다.
- "왜 실패했는가"를 볼 때 가스 조건(limit/used/fee)을 먼저 분리해서 본다.

