# 9강. 트랜잭션 결과 구분: 성공(Success)·실패(Failure)는 “돈이 갔냐”가 아니라 “상태가 바뀌었냐”다

## 1) 이 강의의 한 문장
**성공/실패는 감정이 아니라 ‘상태(State) 전이의 결과’다.**  
트랜잭션은 실패해도 “아무 일도 없던 것”이 아니라, **의사결정이 제출되었고 실행이 시도되었으며 비용(가스)이 소모되고 기록(영수증/흔적)이 남는 사건**이다.

## 2) 강의 목표 (수강생이 끝나고 할 수 있어야 하는 것)
이 강의를 마치면 수강생은:

1. 성공/실패를 “입금 됐냐/안 됐냐”가 아니라 **상태 변화 관점**으로 정의할 수 있다.  
2. 실패가 발생하는 구조적 원인을 6가지로 분류해 설명할 수 있다(서명/검증/실행/권한/조건/환경).  
3. “revert”의 의미와 “실패해도 남는 것(영수증/가스/로그)”을 구분할 수 있다.  
4. 실패 트랜잭션을 온체인 분석에서 왜 중요한 데이터로 보는지 설명할 수 있다.  
5. 다음 강의(가스 조건)로 연결: “실패의 많은 원인은 가스/실행 조건과 연결된다”를 이해한다.

## 3) 핵심 정의: 성공/실패는 “상태 변화의 승인 여부”
### 성공(Success)
- 네트워크 검증을 통과했고
- 실행이 완료되어
- 의도된(또는 규칙에 따른) 상태 변화가 반영되었다

### 실패(Failure)
실패는 크게 두 계층이 있다(초급에서 가장 중요한 구분).

- **(A) 포함되기 전 실패(Pre-inclusion failure)**  
  - 트랜잭션이 블록에 포함되기 전에 거부/무효 처리
  - 예: 서명 불일치, nonce 문제로 전파만 되다 사라짐, 기본 조건 위반

- **(B) 포함된 후 실패(On-chain failure / Revert)**  
  - 블록에 포함되었고 실행이 시도되었으나,
  - 실행 중 조건 위반/권한 부족/로직 오류 등으로 revert 되어
  - 핵심 상태 변화가 반영되지 않았다(또는 제한적으로만 반영)

**암기 문장**
- “실패”에는 **블록에 들어가기 전에 실패**와 **들어간 다음 실패(revert)** 가 있다.

## 4) “revert”를 초급 언어로 다시 정의하기
revert는 한 문장으로:
- **“실행 도중 ‘조건이 안 맞아서’ 상태 변경을 되돌리고 멈춘 것”** 이다.

여기서 오해 방지:
- revert가 나면 “상태 변화가 0”이라고 생각하기 쉬운데,
  - 보통 핵심 상태는 되돌지만,
  - 실행 시도 자체는 발생했고
  - 가스는 소비되며
  - 영수증(receipt)은 남는다.

**설계자 포인트**
- revert는 “돈이 안 갔다”가 아니라,  
  “그 행동이 승인되지 않았다(규칙에 의해 기각됐다)”에 가깝다.

## 5) 실패해도 남는 것 4가지(초급에서 반드시)
실패 트랜잭션에서 남는 흔적:

1) **가스 소비(비용)**
- 실행을 시도한 만큼 자원이 소모된다  
- 실패가 “무료”가 아니다

2) **영수증(Receipt)**
- status(성공/실패), gasUsed, (가능하면) revert reason 등

3) **실행 흔적(Trace) / 내부 호출 흔적(환경에 따라)**
- 일부 탐색기나 분석 도구에서 볼 수 있다

4) **의도(Intent)**
- “누가 무엇을 하려 했는가”가 드러난다  
- 온체인 분석에서 이게 매우 강력한 단서가 된다

## 6) 실패 원인의 구조적 분류 6종(“왜 실패했는지”를 계층으로 읽기)
### 서명/키 계층 실패
- 서명이 유효하지 않음
- 잘못된 체인/네트워크(체인ID)에서 만든 트랜잭션
- 키 통제권 문제(지갑 설정 오류 등)

### 검증(Validation) 계층 실패
- nonce 불일치(순서 꼬임)
- 잔액 부족(가스/전송값 포함)
- 기본 규칙 위반(형식 오류 등)

### 합의/환경 계층 실패(“내가 잘못한 게 아닐 수도”)
- 네트워크 혼잡으로 오랫동안 미포함(pending)
- 수수료 조건이 낮아 선택되지 않음
- 재정렬(reorg) 등으로 상태가 바뀌어 조건이 달라짐

### 실행(Execution) 계층 실패: revert
- require 조건 불충족(슬리피지, 기한, 최소 수량 등)
- 컨트랙트 로직이 특정 상태에서 거부
- 외부 호출 실패(다른 컨트랙트/토큰이 거부)

### 권한(Approval/Permission) 계층 실패
- approve(allowance) 부족
- 역할 기반 권한(role) 없음
- 소유자만 실행 가능(onlyOwner 등)

### 사용자 입력/UX 계층 실패
- 잘못된 주소/컨트랙트 선택
- 잘못된 함수 호출
- 파라미터(금액, 슬리피지, deadline) 오입력

**설계자 포인트**
- 실패를 “한 가지 이유”로 보지 말고,  
  **어느 계층에서 실패했는지**로 먼저 분류해야 한다.

## 7) “성공인데 손해” vs “실패인데 의미 있음”
초급이 가장 많이 헷갈리는 비교.

### 성공인데 손해일 수 있다
- 잘못된 주소로 송금 성공(되돌릴 수 없음)
- 스캠 컨트랙트에 승인 성공(권한이 넘어감)
- 나쁜 조건으로 스왑 성공(슬리피지 과다)

### 실패인데 의미가 크다
- 실패는 “방어선이 작동했다”는 뜻일 수 있다
- 실패 트랜잭션은 공격/탐색/봇 활동의 흔적일 수 있다
- 특정 지갑이 어떤 전략을 시도했는지 드러낸다(의도 데이터)

## 8) 온체인 분석 관점: 실패는 “전략의 그림자”다
실패 트랜잭션이 왜 분석에 중요하냐면:

- 사람/봇은 성공 전에 여러 번 시도한다(탐색)  
- 슬리피지/가격/유동성 조건을 맞추려다 실패가 찍힌다  
- 취약점 공격은 여러 번의 실패 후 성공으로 이어질 수 있다  
- 즉, 실패는 “사전 징후”가 된다

**암기 문장**
- 성공은 결과, 실패는 과정이다.  
- 과정은 전략을 보여준다.

## 용어 보충(Quick Reference)
- Success: 실행이 완료되어 상태 변화가 반영된 결과.
- Failure/Revert: 실행 시도는 됐지만 상태 반영이 롤백된 결과.
- Pending: 네트워크 대기열에서 아직 블록에 포함되지 않은 상태.
- Out of Gas: 지정 가스 한도 초과로 실행이 중단된 실패.
- Revert Reason: 컨트랙트가 실패 원인을 텍스트/코드로 남긴 단서.

## 헷갈리는 개념 보충
- 실패 트랜잭션은 "아무 일도 없음"이 아니다.
- 가스 소모, 실패 원인, 로그/영수증 단서가 남아 분석 데이터가 된다.

